<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/layout :: head}">
    <title>User Dashboard - HICMS</title>
</head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{fragments/layout :: navbar}"></nav>
<div th:replace="~{fragments/layout :: alerts}"></div>

<main class="container my-4 flex-grow-1">
    <h2 class="mb-4"><i class="bi bi-speedometer2"></i> My Dashboard</h2>
    
    <p class="lead">Welcome back, <strong th:text="${user.fullName}">User</strong>!</p>
    
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">My Enrollments</h6>
                            <h2 th:text="${totalEnrollments}">0</h2>
                        </div>
                        <i class="bi bi-card-checklist display-4 opacity-50"></i>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <small><span th:text="${activeEnrollments}">0</span> Active</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-dark h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">My Claims</h6>
                            <h2 th:text="${totalClaims}">0</h2>
                        </div>
                        <i class="bi bi-clipboard2-pulse display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Support Tickets</h6>
                            <h2 th:text="${totalTickets}">0</h2>
                        </div>
                        <i class="bi bi-headset display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Available Policies</h6>
                            <h2 th:text="${availablePolicies}">0</h2>
                        </div>
                        <i class="bi bi-file-earmark-text display-4 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-lightning"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <a th:href="@{/policies}" class="btn btn-primary me-2">
                        <i class="bi bi-search"></i> Browse Policies
                    </a>
                    <a th:href="@{/enrollments/enroll}" class="btn btn-success me-2">
                        <i class="bi bi-plus-circle"></i> Enroll in Policy
                    </a>
                    <a th:href="@{/claims/submit}" class="btn btn-warning me-2">
                        <i class="bi bi-clipboard2-plus"></i> Submit Claim
                    </a>
                    <a th:href="@{/support/create}" class="btn btn-info">
                        <i class="bi bi-headset"></i> Create Support Ticket
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- My Enrollments & Claims -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-card-checklist"></i> My Enrollments</h5>
                    <a th:href="@{/enrollments}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(myEnrollments)}" class="text-muted">
                        No enrollments found. <a th:href="@{/enrollments/enroll}">Enroll in a policy</a>
                    </div>
                    <div class="list-group list-group-flush" th:unless="${#lists.isEmpty(myEnrollments)}">
                        <div th:each="enrollment : ${myEnrollments}" class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1" th:text="${enrollment.policyName}">Policy Name</h6>
                                <span class="badge" 
                                      th:classappend="${enrollment.enrollmentStatus.name() == 'ACTIVE'} ? 'bg-success' : 'bg-secondary'"
                                      th:text="${enrollment.enrollmentStatus}">Status</span>
                            </div>
                            <p class="mb-1 small">
                                <strong>Policy #:</strong> <span th:text="${enrollment.policyNumber}">POL-001</span>
                            </p>
                            <small class="text-muted">
                                Coverage: $<span th:text="${enrollment.coverageAmount}">0</span> | 
                                Premium: $<span th:text="${enrollment.premiumAmount}">0</span>/month
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-clipboard2-pulse"></i> My Claims</h5>
                    <a th:href="@{/claims}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(myClaims)}" class="text-muted">
                        No claims found. <a th:href="@{/claims/submit}">Submit a claim</a>
                    </div>
                    <div class="list-group list-group-flush" th:unless="${#lists.isEmpty(myClaims)}">
                        <a th:each="claim : ${myClaims}" th:href="@{/claims/view/{id}(id=${claim.claimId})}" 
                           class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1" th:text="${claim.claimNumber}">CLM-001</h6>
                                <span class="badge" 
                                      th:classappend="${claim.claimStatus.name() == 'APPROVED'} ? 'bg-success' : 
                                                     (${claim.claimStatus.name() == 'REJECTED'} ? 'bg-danger' : 
                                                     (${claim.claimStatus.name() == 'PENDING'} ? 'bg-warning text-dark' : 'bg-info'))"
                                      th:text="${claim.claimStatus}">Status</span>
                            </div>
                            <p class="mb-1" th:text="${claim.policyName}">Policy Name</p>
                            <small>Amount: $<span th:text="${claim.claimAmount}">0.00</span></small>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/layout :: footer}"></footer>
<div th:replace="~{fragments/layout :: scripts}"></div>
</body>
</html>
